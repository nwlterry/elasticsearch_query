{
  "track_total_hits": false,
  "size": 0,
  "query": {
    "bool": {
      "filter": [
        { "term": { "processor.event": "metric" } },
        { "term": { "metricset.name": "service_destination" } },
        {
          "bool": {
            "must": [
              { "term": { "span.destination.service.resource": "as400" } }
            ],
            "should": [
              { "query_string": { "fields": ["span.destination.service.resource"], "query": "*as400*" } }
            ],
            "minimum_should_match": 1
          }
        },
        {
          "range": {
            "@timestamp": {
              "gte": "now-1y",           // ‚Üê change to: now-1w, now-1M, now-1y, or absolute timestamps
              "lte": "now",
              "format": "epoch_millis"   // or remove format if using date_math like now-1y
            }
          }
        },
        {
          "bool": {
            "must_not": [
              { "terms": { "metricset.interval": ["10m", "60m"] } }
            ]
          }
        }
      ]
    }
  },
  "aggs": {
    "total_calls": {
      "sum": {
        "field": "span.destination.service.response_time.count"
      }
    },
    "avg_throughput_per_min": {
      "avg": {
        "field": "span.destination.service.response_time.count"
      }
    }
  }
}
